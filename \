#include "operations/operations.h"
#include "utils/error.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int operations_init(FT_HANDLE ftHandle, dac63004w_context *ctx, float vref) {
  ctx->ftdi = ftHandle;
  return dac63004w_init(ctx, vref);
}

int handle_dc_voltage(dac63004w_context *ctx, uint8_t channel, float arg1) {
  if (!ctx || !ctx->ftdi) {
    fprintf(stderr, "Invalid DAC context.\n");
    return EXIT_FAILURE;
  }
  if (dac63004w_write_voltage(ctx, channel, arg1) != 0) {
    fprintf(stderr, "Error setting voltage on channel %d.\n", channel);
    return EXIT_FAILURE;
  }
  printf("Voltage set to %.2fV on channel %d.\n", arg1, channel);
  return 0;
}
int handle_sine_voltage(dac63004w_context *ctx, uint8_t channel,
                        float amplitude, float frequency) {
  printf("Here is a sine wave! \n");
  return EXIT_SUCCESS;
}
dc_operation_t dc_operations[] = {
    {"voltage", handle_voltage}, {"current", handle_current}, {NULL, NULL}};

ac_operation_t ac_operations[] = {{"sine_v", handle_sine_voltage},
                                  {"sine_i", handle_sine_current},
                                  {"sawtooth_v", handle_sawtooth_voltage},
                                  {"sawtooth_i", handle_sawtooth_current},
                                  {"triangle_v", handle_triangle_voltage},
                                  {"triangle_i", handle_triangle_current},
                                  {NULL, NULL}};
operation_handler_t find_operation(const char *name) {
  for (operation_t *op = dac_operations; op->name != NULL; ++op) {
    if (strcmp(op->name, name) == 0) {
      return op->handler;
    }
  }
  return NULL;
}
